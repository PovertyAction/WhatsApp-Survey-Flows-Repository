{
  "description": "sisben_referidos_sf_stage2",
  "states": [
    {
      "name": "Trigger",
      "type": "trigger",
      "transitions": [
        {
          "event": "incomingMessage"
        },
        {
          "event": "incomingCall"
        },
        {
          "event": "incomingConversationMessage"
        },
        {
          "event": "incomingRequest"
        },
        {
          "next": "ref_intro1",
          "event": "incomingParent"
        }
      ],
      "properties": {
        "offset": {
          "x": -1810,
          "y": -620
        }
      }
    },
    {
      "name": "set_delivery_failed",
      "type": "set-variables",
      "transitions": [
        {
          "next": "encriptador",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_delivery_failed -%} {{flow.variables.set_delivery_failed | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_delivery_failed"
          }
        ],
        "offset": {
          "x": 170,
          "y": 400
        }
      }
    },
    {
      "name": "codigo_referido",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2220,
          "y": 680
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Para poder ser inscrito en el estudio, por favor escribe el *código que te compartieron*.\n\nRecuerda que el código tiene 7 caracteres.",
        "timeout": "3600"
      }
    },
    {
      "name": "split_ref2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido.inbound.Body}}",
        "offset": {
          "x": -1610,
          "y": 670
        }
      }
    },
    {
      "name": "ref_intro1",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply_ref",
          "event": "timeout"
        },
        {
          "next": "set_delivery_failed",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -1650,
          "y": 200
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¡Hola!\n\nMuchas gracias por comunicarte con nosotros. En este momento este canal está habilitado para la *recepción de mensajes sobre referidos* del estudio sobre el registro de venezolanos regulares en el Sisbén. \n\nEnvía:\n*1* si tu respuesta es: *Me quiero registrar con algún código de referidos*\n*2* si tu respuesta es: *Ya soy participante*",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref",
          "event": "success"
        },
        {
          "next": "split_ref",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1970,
          "y": 200
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref",
          "event": "noMatch"
        },
        {
          "next": "intro_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Ya soy participante",
              "arguments": [
                "{{widgets.ref_intro1.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "Ya soy participante,YA SOY PARTICIPANTE,si,SI,SÍ,sí,2, 2,2 ,2."
            }
          ]
        },
        {
          "next": "codigo_referido",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Me quiero registrar",
              "arguments": [
                "{{widgets.ref_intro1.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "Me quiero registrar,ME QUIERO REGISTRAR,1, 1,1 ,1."
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.ref_intro1.inbound.Body}}",
        "offset": {
          "x": -2440,
          "y": 200
        }
      }
    },
    {
      "name": "set_ref",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref -%} {{flow.variables.set_ref | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref"
          }
        ],
        "offset": {
          "x": -2750,
          "y": 200
        }
      }
    },
    {
      "name": "split_ref_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_1",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref}}",
        "offset": {
          "x": -3090,
          "y": 200
        }
      }
    },
    {
      "name": "send_message_1",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_2",
          "event": "sent"
        },
        {
          "next": "function_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -3400,
          "y": 200
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el texto *Ya soy participante* o * Me quiero registrar*"
      }
    },
    {
      "name": "function_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "ref_intro1",
          "event": "success"
        },
        {
          "next": "ref_intro1",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3710,
          "y": 200
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "closure_participants",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "function_participant",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3360,
          "y": 3640
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Muchas gracias por tu tiempo. Este canal de comunicación se encuentra cerrado. \n\n_*Equipo IPA*_",
        "timeout": "10"
      }
    },
    {
      "name": "set_noreply_ref",
      "type": "set-variables",
      "transitions": [
        {
          "next": "encriptador",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_noreply_ref -%} {{flow.variables.set_noreply_ref | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_noreply_ref"
          }
        ],
        "offset": {
          "x": -2800,
          "y": 680
        }
      }
    },
    {
      "name": "wait_ref2",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2",
          "event": "success"
        },
        {
          "next": "split_ref2",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1910,
          "y": 680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "set_ref2",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2 -%} {{flow.variables.set_ref2 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2"
          }
        ],
        "offset": {
          "x": -1290,
          "y": 680
        }
      }
    },
    {
      "name": "split_ref_22",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo",
          "event": "noMatch"
        },
        {
          "next": "invalid_code_1",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{flow.variables.set_ref2}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2}}",
        "offset": {
          "x": -980,
          "y": 680
        }
      }
    },
    {
      "name": "error_codigo",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22",
          "event": "sent"
        },
        {
          "next": "function_22",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -670,
          "y": 680
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido",
          "event": "success"
        },
        {
          "next": "codigo_referido",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -360,
          "y": 680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "set_survey_failed_ref",
      "type": "set-variables",
      "transitions": [
        {
          "next": "encriptador",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_survey_failed_ref -%} {{flow.variables.set_survey_failed_ref | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_survey_failed_ref"
          }
        ],
        "offset": {
          "x": -2830,
          "y": 1190
        }
      }
    },
    {
      "name": "set_noreply1_ref",
      "type": "set-variables",
      "transitions": [
        {
          "next": "encriptador",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_noreply1_ref -%} {{flow.variables.set_noreply1_ref | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_noreply1_ref"
          }
        ],
        "offset": {
          "x": -2830,
          "y": 950
        }
      }
    },
    {
      "name": "ref_name",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref3",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2910,
          "y": 11130
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Por favor escribe tu nombre completo. \n\nResponde únicamente tu nombre con *letras*, NO incluyas caracteres especiales, tildes ni ñ.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref3",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref3",
          "event": "success"
        },
        {
          "next": "split_ref3",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2580,
          "y": 11140
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref3",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref3",
          "event": "noMatch"
        },
        {
          "next": "ref_access",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid name",
              "arguments": [
                "{{widgets.ref_name.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[a-zA-Z_ ]*$"
            }
          ]
        },
        {
          "next": "ref_access",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Omitir",
              "arguments": [
                "{{widgets.ref_name.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "omitir,OMITIR,Omitir"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.ref_name.inbound.Body}}",
        "offset": {
          "x": -2270,
          "y": 11140
        }
      }
    },
    {
      "name": "set_ref3",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_3",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref3 -%} {{flow.variables.set_ref3 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref3"
          }
        ],
        "offset": {
          "x": -1900,
          "y": 11140
        }
      }
    },
    {
      "name": "split_ref_3",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_nombre",
          "event": "noMatch"
        },
        {
          "next": "ref_access",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref3}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref3}}",
        "offset": {
          "x": -1620,
          "y": 11140
        }
      }
    },
    {
      "name": "error_nombre",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_3",
          "event": "sent"
        },
        {
          "next": "function_3",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1280,
          "y": 11130
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No logro entender tu respuesta, recuerda enviar únicamente tu nombre sin caracteres especiales. *NO incluyas tildes ni ñ*.\n\nSoy un robot y no puedo entender otro tipo de respuestas."
      }
    },
    {
      "name": "function_3",
      "type": "run-function",
      "transitions": [
        {
          "next": "ref_name",
          "event": "success"
        },
        {
          "next": "ref_name",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -970,
          "y": 11110
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "invalid_code",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_invalid_code",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2220,
          "y": 870
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Vamos a validar los códigos que nos has compartido. \n\nA continuación, te haremos una serie de preguntas para completar el registro."
      }
    },
    {
      "name": "ref_access",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref4",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2910,
          "y": 11350
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Tienes acceso a un teléfono con WhatsApp propio o compartido? \n\nEnvía:\n*1* si tu respuesta es: *Sí, para mi único uso*\n*2* si tu respuesta es: *Sí, compartido con personas de mi hogar*\n*3* si tu respuesta es: *Sí, compartido con personas de otro hogar*\n*4* si tu respuesta es: *No*",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref4",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref4",
          "event": "success"
        },
        {
          "next": "split_ref4",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2560,
          "y": 11370
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref4",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref4",
          "event": "noMatch"
        },
        {
          "next": "phone1_number",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Tiene",
              "arguments": [
                "{{widgets.ref_access.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1,2,3, 1, 2, 3,1 ,2 ,3 "
            }
          ]
        },
        {
          "next": "phone2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Omitir",
              "arguments": [
                "{{widgets.ref_access.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "omitir,Omitir,OMITIR"
            }
          ]
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "No tiene",
              "arguments": [
                "{{widgets.ref_access.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "4, 4,4 ,no,NO,No"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.ref_access.inbound.Body}}",
        "offset": {
          "x": -2290,
          "y": 11360
        }
      }
    },
    {
      "name": "set_ref4",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_4",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref4 -%} {{flow.variables.set_ref4 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref4"
          }
        ],
        "offset": {
          "x": -1920,
          "y": 11360
        }
      }
    },
    {
      "name": "split_ref_4",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_telefono1",
          "event": "noMatch"
        },
        {
          "next": "phone2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref4}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref4}}",
        "offset": {
          "x": -1600,
          "y": 11360
        }
      }
    },
    {
      "name": "error_telefono1",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_4",
          "event": "sent"
        },
        {
          "next": "function_4",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1300,
          "y": 11360
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No logro entender tu respuesta, recuerda enviar únicamente el *número* que se relaciona a tu respuesta.\n\nSoy un robot y no puedo entender otro tipo de respuestas."
      }
    },
    {
      "name": "function_4",
      "type": "run-function",
      "transitions": [
        {
          "next": "ref_access",
          "event": "success"
        },
        {
          "next": "ref_access",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -950,
          "y": 11360
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "function_5",
      "type": "run-function",
      "transitions": [
        {
          "next": "phone1_owner",
          "event": "success"
        },
        {
          "next": "phone1_owner",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -910,
          "y": 11890
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "error_phone1_owner",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_5",
          "event": "sent"
        },
        {
          "next": "function_5",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1240,
          "y": 11900
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No logro entender tu respuesta, recuerda enviar únicamente el *número* que se relaciona a tu respuesta.\n\nSoy un robot y no puedo entender otro tipo de respuestas."
      }
    },
    {
      "name": "split_ref_5",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_phone1_owner",
          "event": "noMatch"
        },
        {
          "next": "phone2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref5}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref5}}",
        "offset": {
          "x": -1590,
          "y": 11910
        }
      }
    },
    {
      "name": "set_ref5",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_5",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref5 -%} {{flow.variables.set_ref5 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref5"
          }
        ],
        "offset": {
          "x": -1900,
          "y": 11920
        }
      }
    },
    {
      "name": "split_ref5",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref5",
          "event": "noMatch"
        },
        {
          "next": "phone2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "SI",
              "arguments": [
                "{{widgets.phone1_owner.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "SI,si, si,si , SI,SI ,SI.,si.,1,1 , 1,1."
            }
          ]
        },
        {
          "next": "phone1_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "NO",
              "arguments": [
                "{{widgets.phone1_owner.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2,2 ,2."
            }
          ]
        },
        {
          "next": "phone2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Omitir",
              "arguments": [
                "{{widgets.phone1_owner.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "omitir,Omitir,OMITIR"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.phone1_owner.inbound.Body}}",
        "offset": {
          "x": -2230,
          "y": 11910
        }
      }
    },
    {
      "name": "wait_ref5",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref5",
          "event": "success"
        },
        {
          "next": "split_ref5",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2570,
          "y": 11930
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "phone1_owner",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref5",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2910,
          "y": 11940
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿El número es tuyo o de alguna otra persona?  \n\nEnvía:\n*1* si tu respuesta es: *Yo soy la persona propietaria*\n*2* si tu respuesta es: *Yo no soy la persona propietaria*",
        "timeout": "3600"
      }
    },
    {
      "name": "phone1_name",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref6",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2890,
          "y": 12210
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Nos podrías indicar por favor el nombre de esa persona? \n\nResponde únicamente el nombre con *letras*, NO incluyas caracteres especiales, tildes ni ñ.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref6",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref6",
          "event": "success"
        },
        {
          "next": "split_ref6",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2550,
          "y": 12200
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "set_ref6",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_6",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref6 -%} {{flow.variables.set_ref6 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref6"
          }
        ],
        "offset": {
          "x": -1880,
          "y": 12190
        }
      }
    },
    {
      "name": "split_ref_6",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_phone1_name",
          "event": "noMatch"
        },
        {
          "next": "phone2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref6}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref6}}",
        "offset": {
          "x": -1570,
          "y": 12190
        }
      }
    },
    {
      "name": "error_phone1_name",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_6",
          "event": "sent"
        },
        {
          "next": "function_6",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1240,
          "y": 12180
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el nombre sin caracteres especiales. *NO incluyas tildes ni ñ*."
      }
    },
    {
      "name": "function_6",
      "type": "run-function",
      "transitions": [
        {
          "next": "phone1_name",
          "event": "success"
        },
        {
          "next": "phone1_name",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -910,
          "y": 12180
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref6",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref6",
          "event": "noMatch"
        },
        {
          "next": "phone2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid name",
              "arguments": [
                "{{widgets.phone1_name.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[a-zA-Z_ ]*$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.phone1_name.inbound.Body}}",
        "offset": {
          "x": -2220,
          "y": 12190
        }
      }
    },
    {
      "name": "phone1_number",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref7",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2920,
          "y": 11670
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Cuál es el número de ese teléfono con WhatsApp?",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref7",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref7",
          "event": "success"
        },
        {
          "next": "split_ref7",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2610,
          "y": 11680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref7",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref7",
          "event": "noMatch"
        },
        {
          "next": "phone1_owner",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid phone",
              "arguments": [
                "{{widgets.phone1_number.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[3-4][0-9]{9}$"
            }
          ]
        },
        {
          "next": "phone2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Omitir",
              "arguments": [
                "{{widgets.phone1_number.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "omitir,Omitir,OMITIR"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.phone1_number.inbound.Body}}",
        "offset": {
          "x": -2280,
          "y": 11680
        }
      }
    },
    {
      "name": "set_ref7",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_7",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref7 -%} {{flow.variables.set_ref7 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref7"
          }
        ],
        "offset": {
          "x": -1920,
          "y": 11680
        }
      }
    },
    {
      "name": "split_ref_7",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_telefono2",
          "event": "noMatch"
        },
        {
          "next": "phone1_number",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref7}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref7}}",
        "offset": {
          "x": -1580,
          "y": 11680
        }
      }
    },
    {
      "name": "error_telefono2",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_7",
          "event": "sent"
        },
        {
          "next": "function_7",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1260,
          "y": 11680
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No logro entender tu respuesta, recuerda enviar únicamente tu  número de telefono *sin espacios y sin incluir el indicativo de país.*\n\nSoy un robot y no puedo entender otro tipo de respuestas."
      }
    },
    {
      "name": "function_7",
      "type": "run-function",
      "transitions": [
        {
          "next": "phone1_number",
          "event": "success"
        },
        {
          "next": "phone1_number",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -940,
          "y": 11680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "function_participant",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_participant",
          "event": "success"
        },
        {
          "next": "split_participant",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3790,
          "y": 3680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_participant",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_participant",
          "event": "noMatch"
        },
        {
          "next": "encriptador",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "key",
              "arguments": [
                "{{widgets.closure_participant.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1010235518"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.closure_participant.inbound.Body}}",
        "offset": {
          "x": -4140,
          "y": 3650
        }
      }
    },
    {
      "name": "set_participant",
      "type": "set-variables",
      "transitions": [
        {
          "next": "encriptador",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_participant -%} {{flow.variables.set_participant | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_participant"
          }
        ],
        "offset": {
          "x": -4480,
          "y": 3670
        }
      }
    },
    {
      "name": "encriptador",
      "type": "run-function",
      "transitions": [
        {
          "next": "pub_gsheets_referidos",
          "event": "success"
        },
        {
          "next": "pub_gsheets_referidos",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS1161adc18ebc342b09069b3f1bc21ae1",
        "environment_sid": "ZE2a970e75d41f69acd4a250ef48abdd02",
        "offset": {
          "x": -2140,
          "y": 16180
        },
        "function_sid": "ZH2bcfa71f468d237313d4b6a1cdd026c2",
        "parameters": [
          {
            "value": "{{widgets.ref_name.inbound.Body}}",
            "key": "name"
          },
          {
            "value": "{{widgets.phone1_number.inbound.Body}}",
            "key": "phone1"
          },
          {
            "value": "{{widgets.phone1_name.inbound.Body}}",
            "key": "phone1_name"
          },
          {
            "value": "{{widgets.phone2_number.inbound.Body}}",
            "key": "phone2"
          },
          {
            "value": "{{widgets.phone2_name.inbound.Body}}",
            "key": "phone2_name"
          },
          {
            "value": "{{widgets.wapp_participante.inbound.Body}}",
            "key": "wapp_participante"
          },
          {
            "value": "{{widgets.wapp_participante2.inbound.Body}}",
            "key": "wapp_participante2"
          },
          {
            "value": "{{widgets.correo_participante.inbound.Body}}",
            "key": "correo_participante"
          },
          {
            "value": "{{widgets.celular_participante.inbound.Body}}",
            "key": "celular_participante"
          }
        ],
        "url": "https://encrypt-9407.twil.io/encrypter"
      }
    },
    {
      "name": "pub_gsheets_referidos",
      "type": "run-function",
      "transitions": [
        {
          "event": "success"
        },
        {
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "default",
        "offset": {
          "x": -2170,
          "y": 16470
        },
        "parameters": [
          {
            "value": "{{widgets.ref_intro1.inbound.Body}}",
            "key": "intro1_referidxs"
          },
          {
            "value": "{{widgets.codigo_referido.inbound.Body}}",
            "key": "codigo_referido"
          },
          {
            "value": "{{widgets.encriptador.parsed.name}}",
            "key": "name"
          },
          {
            "value": "{{widgets.encriptador.parsed.phone1}}",
            "key": "phone1"
          },
          {
            "value": "{{widgets.encriptador.parsed.phone1_name}}",
            "key": "phone1_name"
          },
          {
            "value": "{{widgets.encriptador.parsed.phone2}}",
            "key": "phone2"
          },
          {
            "value": "{{widgets.encriptador.parsed.phone2_name}}",
            "key": "phone2_name"
          },
          {
            "value": "{{widgets.phone1_owner.inbound.Body}}",
            "key": "phone1_owner"
          },
          {
            "value": "{{widgets.phone2_owner.inbound.Body}}",
            "key": "phone2_owner"
          },
          {
            "value": "{{widgets.intro_participante.inbound.Body}}",
            "key": "intro_participante"
          },
          {
            "value": "{{widgets.menu_participante.inbound.Body}}",
            "key": "menu_participante"
          },
          {
            "value": "{{widgets.menu_participante_3.inbound.Body}}",
            "key": "menu_participante_3"
          },
          {
            "value": "{{widgets.codigo_participante.inbound.Body}}",
            "key": "codigo_participante"
          },
          {
            "value": "{{widgets.conf_codigo_participantenbound.Body}}",
            "key": "conf_codigo_participante"
          },
          {
            "value": "{{widgets.encriptador.parsed.wapp_participante}}",
            "key": "wapp_participante"
          },
          {
            "value": "{{widgets.encriptador.parsed.correo_participante}}",
            "key": "correo_participante"
          },
          {
            "value": "{{widgets.encriptador.parsed.wapp_participante2}}",
            "key": "wapp_participante2"
          },
          {
            "value": "{{widgets.conf_codigo_referido.inbound.Body}}",
            "key": "conf_codigo_referido"
          },
          {
            "value": "{{widgets.conf_codigo_referido1.inbound.Body}}",
            "key": "conf_codigo_referido1"
          },
          {
            "value": "{{widgets.conf_codigo_referido2.inbound.Body}}",
            "key": "conf_codigo_referido2"
          },
          {
            "value": "{{widgets.conf_codigo_referido3.inbound.Body}}",
            "key": "conf_codigo_referido3"
          },
          {
            "value": "{{widgets.conf_codigo_referido4.inbound.Body}}",
            "key": "conf_codigo_referido4"
          },
          {
            "value": "{{widgets.conf_codigo_referido5.inbound.Body}}",
            "key": "conf_codigo_referido5"
          },
          {
            "value": "{{widgets.conf_codigo_referido6.inbound.Body}}",
            "key": "conf_codigo_referido6"
          },
          {
            "value": "{{widgets.conf_codigo_referido7.inbound.Body}}",
            "key": " conf_codigo_referido7"
          },
          {
            "value": "{{widgets.conf_codigo_referido8.inbound.Body}}",
            "key": "conf_codigo_referido8"
          },
          {
            "value": "{{widgets.conf_codigo_referido9.inbound.Body}}",
            "key": "conf_codigo_referido9"
          },
          {
            "value": "{{widgets.codigo_referido1.inbound.Body}}",
            "key": "codigo_referido1"
          },
          {
            "value": "{{widgets.codigo_referido1a.inbound.Body}}",
            "key": "codigo_referido1a"
          },
          {
            "value": "{{widgets.codigo_referido2.inbound.Body}}",
            "key": "codigo_referido2"
          },
          {
            "value": "{{widgets.codigo_referido2a.inbound.Body}}",
            "key": "codigo_referido2a"
          },
          {
            "value": "{{widgets.codigo_referido3.inbound.Body}}",
            "key": "codigo_referido3"
          },
          {
            "value": "{{widgets.codigo_referido3a.inbound.Body}}",
            "key": "codigo_referido3a"
          },
          {
            "value": "{{widgets.codigo_referido4.inbound.Body}}",
            "key": "codigo_referido4"
          },
          {
            "value": "{{widgets.codigo_referido4a.inbound.Body}}",
            "key": "codigo_referido4a"
          },
          {
            "value": "{{widgets.codigo_referido5.inbound.Body}}",
            "key": "codigo_referido5"
          },
          {
            "value": "{{widgets.codigo_referido5a.inbound.Body}}",
            "key": "codigo_referido5a"
          },
          {
            "value": "{{widgets.codigo_referido6.inbound.Body}}",
            "key": "codigo_referido6"
          },
          {
            "value": "{{widgets.codigo_referido6a.inbound.Body}}",
            "key": "codigo_referido6a"
          },
          {
            "value": "{{widgets.codigo_referido7.inbound.Body}}",
            "key": "codigo_referido7"
          },
          {
            "value": "{{widgets.codigo_referido7a.inbound.Body}}",
            "key": "codigo_referido7a"
          },
          {
            "value": "{{widgets.codigo_referido8.inbound.Body}}",
            "key": "codigo_referido8"
          },
          {
            "value": "{{widgets.codigo_referido8a.inbound.Body}}",
            "key": "codigo_referido8a"
          },
          {
            "value": "{{widgets.codigo_referido9.inbound.Body}}",
            "key": "codigo_referido9"
          },
          {
            "value": "{{widgets.codigo_referido9a.inbound.Body}}",
            "key": "codigo_referido9a"
          },
          {
            "value": "{{flow.variables.set_noreply_ref}}",
            "key": "set_initial_noreply"
          },
          {
            "value": "{{flow.variables.set_delivery_failed}}",
            "key": "set_initial_fail"
          },
          {
            "value": "{{flow.variables.set_noreply1_ref}}",
            "key": "set_survey_noreply"
          },
          {
            "value": "{{flow.variables.set_survey_failed}}",
            "key": "set_survey_failed"
          },
          {
            "value": "{{widgets.ref_access.inbound.Body}}",
            "key": "access"
          },
          {
            "value": "{{widgets.encriptador.parsed.celular_participante}}",
            "key": "celular_participante"
          }
        ],
        "url": "https://persimmon-zebra-6468.twil.io/flyer2"
      }
    },
    {
      "name": "function_references",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_referidos",
          "event": "success"
        },
        {
          "next": "split_referidos",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2490,
          "y": 15740
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "closure_referidos",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "function_references",
          "event": "incomingMessage"
        },
        {
          "next": "encriptador",
          "event": "timeout"
        },
        {
          "next": "encriptador",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2830,
          "y": 15750
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Gracias por tus respuestas. Nos estaremos comunicando en próximos días.\n\n_*Equipo IPA*_",
        "timeout": "10"
      }
    },
    {
      "name": "split_referidos",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_referidos",
          "event": "noMatch"
        },
        {
          "next": "encriptador",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "key",
              "arguments": [
                "{{widgets.closure_referidos.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1010235518"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.closure_referidos.inbound.Body}}",
        "offset": {
          "x": -2100,
          "y": 15740
        }
      }
    },
    {
      "name": "set_referidos",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_referidos_1",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_referidos -%} {{flow.variables.set_referidos | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_referidos"
          }
        ],
        "offset": {
          "x": -1740,
          "y": 15710
        }
      }
    },
    {
      "name": "split_referidos_1",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "closure_referidos",
          "event": "noMatch"
        },
        {
          "next": "encriptador",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">0",
              "arguments": [
                "{{flow.variables.set_referidos}}"
              ],
              "type": "greater_than",
              "value": "0"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_referidos}}",
        "offset": {
          "x": -1380,
          "y": 15700
        }
      }
    },
    {
      "name": "intro_participante",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_intro_participante",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3550,
          "y": 580
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Gracias por comunicarte con nosotros. \n\nNos estaremos comunicando contigo para los próximos pasos del estudio. Si tienes alguna inquietud distinta, envía *1*.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_intro_participante",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_intro_participante",
          "event": "success"
        },
        {
          "next": "split_intro_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3870,
          "y": 580
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_intro_participante",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_intro_participante",
          "event": "noMatch"
        },
        {
          "next": "menu_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Sí",
              "arguments": [
                "{{widgets.intro_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "SI,Si,Sí,SÍ,si,sí,SI,1, 1,1 ,1."
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.intro_participante.inbound.Body}}",
        "offset": {
          "x": -4340,
          "y": 580
        }
      }
    },
    {
      "name": "set_intro_participante",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_intro_participante_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_intro_participante -%} {{flow.variables.set_intro_participante | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_intro_participante"
          }
        ],
        "offset": {
          "x": -4650,
          "y": 580
        }
      }
    },
    {
      "name": "split_intro_participante_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_ip",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_intro_participante}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_intro_participante}}",
        "offset": {
          "x": -4990,
          "y": 580
        }
      }
    },
    {
      "name": "send_message_ip",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_intro_participante_2",
          "event": "sent"
        },
        {
          "next": "wait_intro_participante_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5300,
          "y": 580
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "wait_intro_participante_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "intro_participante",
          "event": "success"
        },
        {
          "next": "intro_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5610,
          "y": 580
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "menu_participante",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_menu_participante",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3540,
          "y": 820
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Envía:\n*1*: si deseas información adicional sobre el estudio\n*2*: si tienes dudas sobre incentivos\n*3*: si deseas actualizar información de contacto\n*4*: Otros\n*5*: si quieres registrar un *nuevo código*\n*6*: si quieres volver al menú anterior",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_menu_participante",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_menu_participante",
          "event": "success"
        },
        {
          "next": "split_menu_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3860,
          "y": 820
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_menu_participante",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_menu_participante",
          "event": "noMatch"
        },
        {
          "next": "send_message_mp1",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.menu_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "send_message_mp2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": " 2",
              "arguments": [
                "{{widgets.menu_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        },
        {
          "next": "menu_participante_3",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "3",
              "arguments": [
                "{{widgets.menu_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "3, 3, 3 ,3  ,*3*,tres,3️⃣"
            }
          ]
        },
        {
          "next": "send_message_mp4",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "4",
              "arguments": [
                "{{widgets.menu_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "4, 4, 4 ,4  ,*4*,cuatro,4️⃣"
            }
          ]
        },
        {
          "next": "codigo_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{widgets.menu_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "5, 5, 5 ,5  ,*5*,5️⃣,cinco"
            }
          ]
        },
        {
          "next": "ref_intro1",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "6",
              "arguments": [
                "{{widgets.menu_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "6, 6, 6 ,6  ,*6*,6️⃣,seis"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.menu_participante.inbound.Body}}",
        "offset": {
          "x": -4330,
          "y": 830
        }
      }
    },
    {
      "name": "set_menu_participante",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_menu_participante_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_menu_participante -%} {{flow.variables.set_menu_participante | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_menu_participante"
          }
        ],
        "offset": {
          "x": -4640,
          "y": 820
        }
      }
    },
    {
      "name": "split_menu_participante_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_mp",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_menu_participante}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_menu_participante}}",
        "offset": {
          "x": -4980,
          "y": 820
        }
      }
    },
    {
      "name": "send_message_mp",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_menu_participante_2",
          "event": "sent"
        },
        {
          "next": "wait_menu_participante_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5290,
          "y": 820
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "wait_menu_participante_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "menu_participante",
          "event": "success"
        },
        {
          "next": "menu_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5600,
          "y": 820
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "send_message_mp1",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_send_message_mp1",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -3520,
          "y": 1040
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Escribe tu inquietud a preguntas.ipacol@gmail.com. Por favor especifica tu código de participante para encontrarte en nuestras bases"
      }
    },
    {
      "name": "wait_send_message_mp1",
      "type": "run-function",
      "transitions": [
        {
          "next": "closure_participants",
          "event": "success"
        },
        {
          "next": "closure_participants",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3850,
          "y": 1050
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "send_message_mp2",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_send_message_mp2",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -3500,
          "y": 1240
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Escribe tu inquietud a preguntas.ipacol@gmail.com. Por favor especifica tu código de participante para encontrarte en nuestras bases"
      }
    },
    {
      "name": "wait_send_message_mp2",
      "type": "run-function",
      "transitions": [
        {
          "next": "closure_participants",
          "event": "success"
        },
        {
          "next": "closure_participants",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3830,
          "y": 1250
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "send_message_mp4",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_send_message_mp4",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -3490,
          "y": 1450
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Escribe tu inquietud a preguntas.ipacol@gmail.com. Por favor especifica tu código de participante para encontrarte en nuestras bases"
      }
    },
    {
      "name": "wait_send_message_mp4",
      "type": "run-function",
      "transitions": [
        {
          "next": "closure_participants",
          "event": "success"
        },
        {
          "next": "closure_participants",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3820,
          "y": 1460
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "menu_participante_3",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_menu_participante_3",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3460,
          "y": 1650
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Qué información deseas actualizar?\n\nEnvía \n*1*: si deseas actualizar el WhatsApp para recibir la información del estudio\n*2*: si deseas actualizar el correo electrónico\n*3*: si deseas actualizar WhatsApp y correo electrónico",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_menu_participante_3",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_menu_participante_3",
          "event": "success"
        },
        {
          "next": "split_menu_participante_3",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3770,
          "y": 1650
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_menu_participante_3",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_menu_participante_3",
          "event": "noMatch"
        },
        {
          "next": "wapp_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.menu_participante_3.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "correo_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": " 2",
              "arguments": [
                "{{widgets.menu_participante_3.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        },
        {
          "next": "wapp_participante2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "3",
              "arguments": [
                "{{widgets.menu_participante_3.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "3, 3, 3 ,3  ,*3*,tres,3️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.menu_participante_3.inbound.Body}}",
        "offset": {
          "x": -4240,
          "y": 1650
        }
      }
    },
    {
      "name": "set_menu_participante_3",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_menu_participante_3_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_menu_participante_3 -%} {{flow.variables.set_menu_participante_3 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_menu_participante_3"
          }
        ],
        "offset": {
          "x": -4550,
          "y": 1650
        }
      }
    },
    {
      "name": "split_menu_participante_3_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_mp3",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_menu_participante_3}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_menu_participante_3}}",
        "offset": {
          "x": -4890,
          "y": 1650
        }
      }
    },
    {
      "name": "send_message_mp3",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_menu_participante_3_2",
          "event": "sent"
        },
        {
          "next": "wait_menu_participante_3_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5200,
          "y": 1650
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "wait_menu_participante_3_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "menu_participante_3",
          "event": "success"
        },
        {
          "next": "menu_participante_3",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5510,
          "y": 1650
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "wapp_participante",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_wapp_participante",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3450,
          "y": 1870
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Por favor digita el nuevo WhatsApp al que quieres recibir la información del estudio.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_wapp_participante",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_wapp_participante",
          "event": "success"
        },
        {
          "next": "split_wapp_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3770,
          "y": 1870
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_wapp_participante",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_wapp_participante",
          "event": "noMatch"
        },
        {
          "next": "celular_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Col",
              "arguments": [
                "{{widgets.wapp_participante.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[3][0-9]{9}$"
            }
          ]
        },
        {
          "next": "celular_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Ven",
              "arguments": [
                "{{widgets.wapp_participante.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[4][0-9]{9}$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.wapp_participante.inbound.Body}}",
        "offset": {
          "x": -4240,
          "y": 1870
        }
      }
    },
    {
      "name": "set_wapp_participante",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_wapp_participante_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_wapp_participante -%} {{flow.variables.set_wapp_participante | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_wapp_participante"
          }
        ],
        "offset": {
          "x": -4550,
          "y": 1870
        }
      }
    },
    {
      "name": "split_wapp_participante_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_wp",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_wapp_participante}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_wapp_participante}}",
        "offset": {
          "x": -4890,
          "y": 1870
        }
      }
    },
    {
      "name": "send_message_wp",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_wapp_participante_2",
          "event": "sent"
        },
        {
          "next": "wait_wapp_participante_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5200,
          "y": 1870
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a números que empiecen por 3 o 4 de 10 dígitos."
      }
    },
    {
      "name": "wait_wapp_participante_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "wapp_participante",
          "event": "success"
        },
        {
          "next": "wapp_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5510,
          "y": 1870
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "correo_participante",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_correo_participante",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3420,
          "y": 2090
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Por favor escribe el nuevo correo electrónico que quieres registrar.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_correo_participante",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_correo_participante",
          "event": "success"
        },
        {
          "next": "split_correo_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3810,
          "y": 2090
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_correo_participante",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_correo_participante",
          "event": "noMatch"
        },
        {
          "next": "celular_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Correo",
              "arguments": [
                "{{widgets.correo_participante.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[a-zA-Z0-9+_.-]+@[a-zA-Z0-9.-]+$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.correo_participante.inbound.Body}}",
        "offset": {
          "x": -4230,
          "y": 2080
        }
      }
    },
    {
      "name": "set_correo_participante",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_correo_participante_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_correo_participante -%} {{flow.variables.set_correo_participante | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_correo_participante"
          }
        ],
        "offset": {
          "x": -4560,
          "y": 2080
        }
      }
    },
    {
      "name": "split_correo_participante_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_cp",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_correo_participante}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_correo_participante}}",
        "offset": {
          "x": -4900,
          "y": 2080
        }
      }
    },
    {
      "name": "send_message_cp",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_correo_participante_2",
          "event": "sent"
        },
        {
          "next": "wait_correo_participante_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5210,
          "y": 2080
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta que no tenga el @ y el dominio completo."
      }
    },
    {
      "name": "wait_correo_participante_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "correo_participante",
          "event": "success"
        },
        {
          "next": "correo_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5520,
          "y": 2080
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "wait_wapp_participante2_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "wapp_participante2",
          "event": "success"
        },
        {
          "next": "wapp_participante2",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5510,
          "y": 2320
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "send_message_wp2",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_wapp_participante2_2",
          "event": "sent"
        },
        {
          "next": "wait_wapp_participante2_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5200,
          "y": 2320
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a números que empiecen por 3 o 4 de 10 dígitos."
      }
    },
    {
      "name": "split_wapp_participante2_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_wp2",
          "event": "noMatch"
        },
        {
          "next": "correo_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_wapp_participante2}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_wapp_participante2}}",
        "offset": {
          "x": -4890,
          "y": 2320
        }
      }
    },
    {
      "name": "set_wapp_participante2",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_wapp_participante2_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_wapp_participante2 -%} {{flow.variables.set_wapp_participante2 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_wapp_participante2"
          }
        ],
        "offset": {
          "x": -4560,
          "y": 2320
        }
      }
    },
    {
      "name": "split_wapp_participante2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_wapp_participante2",
          "event": "noMatch"
        },
        {
          "next": "correo_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Col",
              "arguments": [
                "{{widgets.wapp_participante2.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[3][0-9]{9}$"
            }
          ]
        },
        {
          "next": "correo_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Ven",
              "arguments": [
                "{{widgets.wapp_participante2.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[4][0-9]{9}$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.wapp_participante2.inbound.Body}}",
        "offset": {
          "x": -4240,
          "y": 2320
        }
      }
    },
    {
      "name": "wait_wapp_participante2",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_wapp_participante2",
          "event": "success"
        },
        {
          "next": "split_wapp_participante2",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3770,
          "y": 2320
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "wapp_participante2",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_wapp_participante2",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3450,
          "y": 2320
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Por favor digita el nuevo WhatsApp al que quieres recibir la información del estudio.",
        "timeout": "3600"
      }
    },
    {
      "name": "codigo_participante",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_codigo_participante",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3480,
          "y": 2590
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Por favor digita el *nuevo código* que quieres registrar.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_codigo_participante",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_codigo_participante",
          "event": "success"
        },
        {
          "next": "split_codigo_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3800,
          "y": 2590
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_codigo_participante",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_codigo_participante",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_participante.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_participante.inbound.Body}}",
        "offset": {
          "x": -4200,
          "y": 2600
        }
      }
    },
    {
      "name": "set_codigo_participante",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_codigo_participante_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_codigo_participante -%} {{flow.variables.set_codigo_participante | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_codigo_participante"
          }
        ],
        "offset": {
          "x": -4510,
          "y": 2610
        }
      }
    },
    {
      "name": "split_codigo_participante_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_cp_2",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_codigo_participante}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_codigo_participante}}",
        "offset": {
          "x": -4860,
          "y": 2610
        }
      }
    },
    {
      "name": "send_message_cp_2",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_codigo_participante_2",
          "event": "sent"
        },
        {
          "next": "wait_codigo_participante_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5170,
          "y": 2610
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Lo sentimos, no pudimos reconocer este código. Por favor confírmalo nuevamente."
      }
    },
    {
      "name": "wait_codigo_participante_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_participante",
          "event": "success"
        },
        {
          "next": "codigo_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5480,
          "y": 2610
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_participante",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_conf_codigo_participante",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3470,
          "y": 2840
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_participante.inbound.Body}}  es el nuevo código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_conf_codigo_participante",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_conf_codigo_participante",
          "event": "success"
        },
        {
          "next": "split_conf_codigo_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3820,
          "y": 2860
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_conf_codigo_participante",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_conf_codigo_participante",
          "event": "noMatch"
        },
        {
          "next": "celular_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_participante",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_participante.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_participante.inbound.Body}}",
        "offset": {
          "x": -4190,
          "y": 2860
        }
      }
    },
    {
      "name": "set_conf_codigo_participante",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_conf_codigo_participante_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_conf_codigo_participante -%} {{flow.variables.set_conf_codigo_participante | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_conf_codigo_participante"
          }
        ],
        "offset": {
          "x": -4510,
          "y": 2860
        }
      }
    },
    {
      "name": "split_conf_codigo_participante_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_ccp",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_conf_codigo_participante}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_conf_codigo_participante}}",
        "offset": {
          "x": -4840,
          "y": 2860
        }
      }
    },
    {
      "name": "send_message_ccp",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_conf_codigo_participante_2",
          "event": "sent"
        },
        {
          "next": "wait_conf_codigo_participante_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5170,
          "y": 2860
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "wait_conf_codigo_participante_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_participante",
          "event": "success"
        },
        {
          "next": "conf_codigo_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5500,
          "y": 2870
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido1",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2a",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 1470
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nPor registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1*: si quieres agregar otro código\n*2*: si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2a",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2a",
          "event": "success"
        },
        {
          "next": "split_ref2a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1860,
          "y": 1470
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2a",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2a",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido1a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido1.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido1.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido1.inbound.Body}}",
        "offset": {
          "x": -1540,
          "y": 1470
        }
      }
    },
    {
      "name": "set_ref2a",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22a",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2a -%} {{flow.variables.set_ref2a | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2a"
          }
        ],
        "offset": {
          "x": -1230,
          "y": 1470
        }
      }
    },
    {
      "name": "split_ref_22a",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo1",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2a}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2a}}",
        "offset": {
          "x": -920,
          "y": 1470
        }
      }
    },
    {
      "name": "error_codigo1",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22a",
          "event": "sent"
        },
        {
          "next": "function_22a",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -600,
          "y": 1480
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_22a",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido1",
          "event": "success"
        },
        {
          "next": "codigo_referido1",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -290,
          "y": 1480
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido1a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2b",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 1660
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2b",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2b",
          "event": "success"
        },
        {
          "next": "split_ref2b",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1860,
          "y": 1660
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2b",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2b",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido1",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido1a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido1a.inbound.Body}}",
        "offset": {
          "x": -1540,
          "y": 1670
        }
      }
    },
    {
      "name": "set_ref2b",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22b",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2b -%} {{flow.variables.set_ref2b | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2b"
          }
        ],
        "offset": {
          "x": -1210,
          "y": 1680
        }
      }
    },
    {
      "name": "split_ref_22b",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo1a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2b}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2b}}",
        "offset": {
          "x": -880,
          "y": 1690
        }
      }
    },
    {
      "name": "error_codigo1a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22b",
          "event": "sent"
        },
        {
          "next": "function_22b",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -560,
          "y": 1680
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22b",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido1a",
          "event": "success"
        },
        {
          "next": "codigo_referido1a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -240,
          "y": 1680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido2",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2c",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 2250
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nRecuerda que al registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1* si quieres agregar otro código\n*2* si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2c",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2c",
          "event": "success"
        },
        {
          "next": "split_ref2c",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1860,
          "y": 2250
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2c",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2c",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido2a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido2.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido2.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido2.inbound.Body}}",
        "offset": {
          "x": -1530,
          "y": 2250
        }
      }
    },
    {
      "name": "set_ref2c",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22c",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2c -%} {{flow.variables.set_ref2c | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2c"
          }
        ],
        "offset": {
          "x": -1210,
          "y": 2250
        }
      }
    },
    {
      "name": "split_ref_22c",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo2",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2c}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2c}}",
        "offset": {
          "x": -880,
          "y": 2250
        }
      }
    },
    {
      "name": "error_codigo2",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22c",
          "event": "sent"
        },
        {
          "next": "function_22c",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -560,
          "y": 2260
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22c",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido2",
          "event": "success"
        },
        {
          "next": "codigo_referido2",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -240,
          "y": 2260
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido2a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2d",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 2450
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2d",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2d",
          "event": "success"
        },
        {
          "next": "split_ref2d",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1870,
          "y": 2440
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2d",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2d",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido2a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido2a.inbound.Body}}",
        "offset": {
          "x": -1530,
          "y": 2440
        }
      }
    },
    {
      "name": "set_ref2d",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22d",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2d -%} {{flow.variables.set_ref2d | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2d"
          }
        ],
        "offset": {
          "x": -1210,
          "y": 2440
        }
      }
    },
    {
      "name": "split_ref_22d",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo2a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2d}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2d}}",
        "offset": {
          "x": -870,
          "y": 2450
        }
      }
    },
    {
      "name": "error_codigo2a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22d",
          "event": "sent"
        },
        {
          "next": "function_22d",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -550,
          "y": 2450
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22d",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido2a",
          "event": "success"
        },
        {
          "next": "codigo_referido2a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -230,
          "y": 2440
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido3",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2e",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 3010
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nRecuerda que al registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1*: si quieres agregar otro código\n*2*: si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2e",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2e",
          "event": "success"
        },
        {
          "next": "split_ref2e",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1850,
          "y": 3010
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2e",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2e",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido3a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido3.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido3.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido3.inbound.Body}}",
        "offset": {
          "x": -1520,
          "y": 3000
        }
      }
    },
    {
      "name": "set_ref2e",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22e",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2e -%} {{flow.variables.set_ref2e | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2e"
          }
        ],
        "offset": {
          "x": -1210,
          "y": 3000
        }
      }
    },
    {
      "name": "split_ref_22e",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo3",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2e}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2e}}",
        "offset": {
          "x": -870,
          "y": 3010
        }
      }
    },
    {
      "name": "error_codigo3",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22e",
          "event": "sent"
        },
        {
          "next": "function_22e",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -560,
          "y": 3010
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22e",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido3",
          "event": "success"
        },
        {
          "next": "codigo_referido3",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -230,
          "y": 3010
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido3a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2f",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 3190
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2f",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2f",
          "event": "success"
        },
        {
          "next": "split_ref2f",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1860,
          "y": 3190
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2f",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2f",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido3",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido3a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido3a.inbound.Body}}",
        "offset": {
          "x": -1530,
          "y": 3190
        }
      }
    },
    {
      "name": "set_ref2f",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22f",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2f -%} {{flow.variables.set_ref2f | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2f"
          }
        ],
        "offset": {
          "x": -1200,
          "y": 3190
        }
      }
    },
    {
      "name": "split_ref_22f",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo3a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2f}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2f}}",
        "offset": {
          "x": -860,
          "y": 3180
        }
      }
    },
    {
      "name": "error_codigo3a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22f",
          "event": "sent"
        },
        {
          "next": "function_22f",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -540,
          "y": 3180
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22f",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido3a",
          "event": "success"
        },
        {
          "next": "codigo_referido3a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -210,
          "y": 3190
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido4",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2g",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 3750
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nRecuerda que al registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1*: si quieres agregar otro código\n*2*: si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2g",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2g",
          "event": "success"
        },
        {
          "next": "split_ref2g",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1870,
          "y": 3740
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2g",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2g",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido4a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido4.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido4.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido4.inbound.Body}}",
        "offset": {
          "x": -1550,
          "y": 3730
        }
      }
    },
    {
      "name": "set_ref2g",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22g",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2g -%} {{flow.variables.set_ref2g | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2g"
          }
        ],
        "offset": {
          "x": -1230,
          "y": 3740
        }
      }
    },
    {
      "name": "split_ref_22g",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo4",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2g}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2g}}",
        "offset": {
          "x": -910,
          "y": 3740
        }
      }
    },
    {
      "name": "error_codigo4",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22g",
          "event": "sent"
        },
        {
          "next": "function_22g",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -580,
          "y": 3740
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22g",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido4",
          "event": "success"
        },
        {
          "next": "codigo_referido4",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -240,
          "y": 3740
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido4a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2h",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 3970
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2h",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2h",
          "event": "success"
        },
        {
          "next": "split_ref2h",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1850,
          "y": 3970
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2h",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2h",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido4",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido4a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido4a.inbound.Body}}",
        "offset": {
          "x": -1530,
          "y": 3960
        }
      }
    },
    {
      "name": "set_ref2h",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22h",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2h -%} {{flow.variables.set_ref2h | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2h"
          }
        ],
        "offset": {
          "x": -1190,
          "y": 3960
        }
      }
    },
    {
      "name": "split_ref_22h",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo4a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2h}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2h}}",
        "offset": {
          "x": -860,
          "y": 3970
        }
      }
    },
    {
      "name": "error_codigo4a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22h",
          "event": "sent"
        },
        {
          "next": "function_22h",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -540,
          "y": 3970
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22h",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido4a",
          "event": "success"
        },
        {
          "next": "codigo_referido4a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -200,
          "y": 3950
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refa",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2200,
          "y": 1050
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refa",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refa",
          "event": "success"
        },
        {
          "next": "split_refa",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1890,
          "y": 1050
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refa",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refa",
          "event": "noMatch"
        },
        {
          "next": "sm_1",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido.inbound.Body}}",
        "offset": {
          "x": -1570,
          "y": 1050
        }
      }
    },
    {
      "name": "set_refa",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_aa",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refa -%} {{flow.variables.set_refa | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refa"
          }
        ],
        "offset": {
          "x": -1260,
          "y": 1050
        }
      }
    },
    {
      "name": "split_ref_aa",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_a",
          "event": "noMatch"
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refa}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refa}}",
        "offset": {
          "x": -950,
          "y": 1040
        }
      }
    },
    {
      "name": "error_codigo_a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_aa",
          "event": "sent"
        },
        {
          "next": "function_aa",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -650,
          "y": 1050
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_aa",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -340,
          "y": 1050
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_1",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_1",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 1260
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_1",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido1",
          "event": "success"
        },
        {
          "next": "codigo_referido1",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1860,
          "y": 1260
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido1",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refb",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 1850
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido1a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refb",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refb",
          "event": "success"
        },
        {
          "next": "split_refb",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1870,
          "y": 1850
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refb",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refb",
          "event": "noMatch"
        },
        {
          "next": "sm_2",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido1.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido1a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido1.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido1.inbound.Body}}",
        "offset": {
          "x": -1550,
          "y": 1860
        }
      }
    },
    {
      "name": "set_refb",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_bb",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refb -%} {{flow.variables.set_refb | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refb"
          }
        ],
        "offset": {
          "x": -1230,
          "y": 1870
        }
      }
    },
    {
      "name": "split_ref_bb",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_b",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refb}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refb}}",
        "offset": {
          "x": -910,
          "y": 1870
        }
      }
    },
    {
      "name": "error_codigo_b",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_bb",
          "event": "sent"
        },
        {
          "next": "function_bb",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -560,
          "y": 1870
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_bb",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido1",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido1",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -240,
          "y": 1880
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_2",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_2",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 2050
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido2",
          "event": "success"
        },
        {
          "next": "codigo_referido2",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1860,
          "y": 2050
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido2",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refc",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 2630
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido2a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refc",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refc",
          "event": "success"
        },
        {
          "next": "split_refc",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1870,
          "y": 2620
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refc",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refc",
          "event": "noMatch"
        },
        {
          "next": "sm_3",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido2.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido2a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido2.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido2.inbound.Body}}",
        "offset": {
          "x": -1540,
          "y": 2630
        }
      }
    },
    {
      "name": "set_refc",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_cc",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refc -%} {{flow.variables.set_refc | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refc"
          }
        ],
        "offset": {
          "x": -1220,
          "y": 2630
        }
      }
    },
    {
      "name": "split_ref_cc",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_c",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refc}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refc}}",
        "offset": {
          "x": -890,
          "y": 2630
        }
      }
    },
    {
      "name": "error_codigo_c",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_cc",
          "event": "sent"
        },
        {
          "next": "function_cc",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -560,
          "y": 2640
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_cc",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido2",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido2",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -240,
          "y": 2630
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_3",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_3",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 2820
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_3",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido3",
          "event": "success"
        },
        {
          "next": "codigo_referido3",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1840,
          "y": 2820
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido3",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refd",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2170,
          "y": 3380
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido3a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refd",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refd",
          "event": "success"
        },
        {
          "next": "split_refd",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1850,
          "y": 3370
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refd",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refd",
          "event": "noMatch"
        },
        {
          "next": "sm_4",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido3.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido3a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido3.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido3.inbound.Body}}",
        "offset": {
          "x": -1520,
          "y": 3380
        }
      }
    },
    {
      "name": "set_refd",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_dd",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refd -%} {{flow.variables.set_refd | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refd"
          }
        ],
        "offset": {
          "x": -1200,
          "y": 3380
        }
      }
    },
    {
      "name": "split_ref_dd",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_d",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refd}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refd}}",
        "offset": {
          "x": -870,
          "y": 3380
        }
      }
    },
    {
      "name": "error_codigo_d",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_dd",
          "event": "sent"
        },
        {
          "next": "function_dd",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -540,
          "y": 3390
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_dd",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido3",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido3",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -220,
          "y": 3380
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_4",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_4",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 3550
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_4",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido4",
          "event": "success"
        },
        {
          "next": "codigo_referido4",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1830,
          "y": 3540
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido4",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refe",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_delivery_failed",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 4160
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido4a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refe",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refe",
          "event": "success"
        },
        {
          "next": "split_refe",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1870,
          "y": 4140
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refe",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refe",
          "event": "noMatch"
        },
        {
          "next": "sm_5",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido4.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido4a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido4.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido4.inbound.Body}}",
        "offset": {
          "x": -1540,
          "y": 4150
        }
      }
    },
    {
      "name": "set_refe",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_ee",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refe -%} {{flow.variables.set_refe | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refe"
          }
        ],
        "offset": {
          "x": -1220,
          "y": 4150
        }
      }
    },
    {
      "name": "split_ref_ee",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_e",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refe}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refe}}",
        "offset": {
          "x": -890,
          "y": 4150
        }
      }
    },
    {
      "name": "error_codigo_e",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_ee",
          "event": "sent"
        },
        {
          "next": "function_ee",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -560,
          "y": 4160
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_ee",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido4",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido4",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -240,
          "y": 4150
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_5",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_5",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 4340
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_5",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido5",
          "event": "success"
        },
        {
          "next": "codigo_referido5",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1830,
          "y": 4330
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido5",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2i",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2190,
          "y": 4540
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nRecuerda que al registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1*: si quieres agregar otro código\n*2*: si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2i",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2i",
          "event": "success"
        },
        {
          "next": "split_ref2i",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1870,
          "y": 4530
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2i",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2i",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido5a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido5.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido5.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido5.inbound.Body}}",
        "offset": {
          "x": -1550,
          "y": 4520
        }
      }
    },
    {
      "name": "set_ref2i",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22i",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2i -%} {{flow.variables.set_ref2i | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2i"
          }
        ],
        "offset": {
          "x": -1230,
          "y": 4530
        }
      }
    },
    {
      "name": "split_ref_22i",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo5",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2i}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2i}}",
        "offset": {
          "x": -910,
          "y": 4530
        }
      }
    },
    {
      "name": "error_codigo5",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22i",
          "event": "sent"
        },
        {
          "next": "function_22i",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -580,
          "y": 4530
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22i",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido5",
          "event": "success"
        },
        {
          "next": "codigo_referido5",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -240,
          "y": 4530
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido5a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2j",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2130,
          "y": 4750
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2j",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2j",
          "event": "success"
        },
        {
          "next": "split_ref2j",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1800,
          "y": 4750
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2j",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2j",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido5",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido5a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido5a.inbound.Body}}",
        "offset": {
          "x": -1480,
          "y": 4740
        }
      }
    },
    {
      "name": "set_ref2j",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22j",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2j -%} {{flow.variables.set_ref2j | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2j"
          }
        ],
        "offset": {
          "x": -1150,
          "y": 4740
        }
      }
    },
    {
      "name": "split_ref_22j",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo5a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2j}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2j}}",
        "offset": {
          "x": -830,
          "y": 4750
        }
      }
    },
    {
      "name": "error_codigo5a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22j",
          "event": "sent"
        },
        {
          "next": "function_22j",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -530,
          "y": 4740
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22j",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido5a",
          "event": "success"
        },
        {
          "next": "codigo_referido5a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -200,
          "y": 4720
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido5",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_reff",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 4920
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido5a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_reff",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_reff",
          "event": "success"
        },
        {
          "next": "split_reff",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1860,
          "y": 4910
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_reff",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_reff",
          "event": "noMatch"
        },
        {
          "next": "sm_6",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido5.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido5a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido5.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido5.inbound.Body}}",
        "offset": {
          "x": -1530,
          "y": 4920
        }
      }
    },
    {
      "name": "set_reff",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_ff",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_reff -%} {{flow.variables.set_reff | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_reff"
          }
        ],
        "offset": {
          "x": -1210,
          "y": 4920
        }
      }
    },
    {
      "name": "split_ref_ff",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_f",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_reff}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_reff}}",
        "offset": {
          "x": -880,
          "y": 4920
        }
      }
    },
    {
      "name": "error_codigo_f",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_ff",
          "event": "sent"
        },
        {
          "next": "function_ff",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -550,
          "y": 4930
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_ff",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido5",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido5",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -230,
          "y": 4920
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_6",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_6",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 5110
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_6",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido6",
          "event": "success"
        },
        {
          "next": "codigo_referido6",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1830,
          "y": 5100
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido6",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2k",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 5290
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nRecuerda que al registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1*: si quieres agregar otro código\n*2*: si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2k",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2k",
          "event": "success"
        },
        {
          "next": "split_ref2k",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1860,
          "y": 5280
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2k",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2k",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido6a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido6.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido6.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido6.inbound.Body}}",
        "offset": {
          "x": -1540,
          "y": 5270
        }
      }
    },
    {
      "name": "set_ref2k",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22k",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2k -%} {{flow.variables.set_ref2k | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2k"
          }
        ],
        "offset": {
          "x": -1220,
          "y": 5280
        }
      }
    },
    {
      "name": "split_ref_22k",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo6",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2k}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2k}}",
        "offset": {
          "x": -900,
          "y": 5280
        }
      }
    },
    {
      "name": "error_codigo6",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22k",
          "event": "sent"
        },
        {
          "next": "function_22k",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -570,
          "y": 5280
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22k",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido6",
          "event": "success"
        },
        {
          "next": "codigo_referido6",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -250,
          "y": 5280
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido6",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refg",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2170,
          "y": 5690
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido6a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refg",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refg",
          "event": "success"
        },
        {
          "next": "split_refg",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1850,
          "y": 5680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refg",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refg",
          "event": "noMatch"
        },
        {
          "next": "sm_7",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido6.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido6a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido6.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido6.inbound.Body}}",
        "offset": {
          "x": -1520,
          "y": 5690
        }
      }
    },
    {
      "name": "set_refg",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_gg",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refg -%} {{flow.variables.set_refg | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refg"
          }
        ],
        "offset": {
          "x": -1200,
          "y": 5690
        }
      }
    },
    {
      "name": "split_ref_gg",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_g",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refg}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refg}}",
        "offset": {
          "x": -900,
          "y": 5690
        }
      }
    },
    {
      "name": "error_codigo_g",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_gg",
          "event": "sent"
        },
        {
          "next": "function_gg",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -570,
          "y": 5700
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_gg",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido6",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido6",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -260,
          "y": 5690
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido6a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2l",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 5490
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2l",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref2l",
          "event": "success"
        },
        {
          "next": "split_ref2l",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1850,
          "y": 5490
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref2l",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2l",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido6",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido6a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido6a.inbound.Body}}",
        "offset": {
          "x": -1530,
          "y": 5480
        }
      }
    },
    {
      "name": "set_ref2l",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22l",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2l -%} {{flow.variables.set_ref2l | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2l"
          }
        ],
        "offset": {
          "x": -1200,
          "y": 5480
        }
      }
    },
    {
      "name": "split_ref_22l",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo6a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2l}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2l}}",
        "offset": {
          "x": -900,
          "y": 5490
        }
      }
    },
    {
      "name": "error_codigo6a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22l",
          "event": "sent"
        },
        {
          "next": "function_22l",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -600,
          "y": 5480
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22l",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido6a",
          "event": "success"
        },
        {
          "next": "codigo_referido6a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -280,
          "y": 5460
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_7",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_7",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2180,
          "y": 5880
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_7",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido7",
          "event": "success"
        },
        {
          "next": "codigo_referido7",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1830,
          "y": 5870
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido7",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2m",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2170,
          "y": 6050
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nRecuerda que al registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1*: si quieres agregar otro código\n*2*: si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2m",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refm",
          "event": "success"
        },
        {
          "next": "split_refm",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1850,
          "y": 6040
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refm",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2m",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido7a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido7.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido7.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido7.inbound.Body}}",
        "offset": {
          "x": -1530,
          "y": 6030
        }
      }
    },
    {
      "name": "set_ref2m",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22m",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2m -%} {{flow.variables.set_ref2m | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2m"
          }
        ],
        "offset": {
          "x": -1210,
          "y": 6040
        }
      }
    },
    {
      "name": "split_ref_22m",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo7",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2m}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2m}}",
        "offset": {
          "x": -890,
          "y": 6040
        }
      }
    },
    {
      "name": "error_codigo7",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22m",
          "event": "sent"
        },
        {
          "next": "invalid_code",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -560,
          "y": 6040
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22m",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido7",
          "event": "success"
        },
        {
          "next": "codigo_referido7",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -240,
          "y": 6040
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido7a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2n",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2150,
          "y": 6230
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2n",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refn",
          "event": "success"
        },
        {
          "next": "split_refn",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1820,
          "y": 6230
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refn",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2n",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido7",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido7a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido7a.inbound.Body}}",
        "offset": {
          "x": -1500,
          "y": 6230
        }
      }
    },
    {
      "name": "set_ref2n",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22n",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2n -%} {{flow.variables.set_ref2n | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2n"
          }
        ],
        "offset": {
          "x": -1180,
          "y": 6230
        }
      }
    },
    {
      "name": "split_ref_22n",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo7a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2n}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2n}}",
        "offset": {
          "x": -840,
          "y": 6240
        }
      }
    },
    {
      "name": "error_codigo7a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22n",
          "event": "sent"
        },
        {
          "next": "function_22n",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -540,
          "y": 6230
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22n",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido7a",
          "event": "success"
        },
        {
          "next": "codigo_referido7a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -220,
          "y": 6230
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido7",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refo",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2130,
          "y": 6430
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido7a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refo",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refo",
          "event": "success"
        },
        {
          "next": "split_refo",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1810,
          "y": 6430
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refo",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refo",
          "event": "noMatch"
        },
        {
          "next": "sm_8",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido7.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido7a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido7.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido7.inbound.Body}}",
        "offset": {
          "x": -1480,
          "y": 6430
        }
      }
    },
    {
      "name": "set_refo",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_oo",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refo -%} {{flow.variables.set_refo| plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refo"
          }
        ],
        "offset": {
          "x": -1160,
          "y": 6440
        }
      }
    },
    {
      "name": "split_ref_oo",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_o",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refo}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refo}}",
        "offset": {
          "x": -820,
          "y": 6440
        }
      }
    },
    {
      "name": "error_codigo_o",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_oo",
          "event": "sent"
        },
        {
          "next": "function_oo",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -530,
          "y": 6440
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_oo",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido7",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido7",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -230,
          "y": 6430
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_8",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_8",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2160,
          "y": 6620
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_8",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido8",
          "event": "success"
        },
        {
          "next": "codigo_referido8",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1820,
          "y": 6620
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido8",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2p",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2130,
          "y": 6830
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nRecuerda que al registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1*: si quieres agregar otro código\n*2*: si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2p",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refp",
          "event": "success"
        },
        {
          "next": "split_refp",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1810,
          "y": 6820
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refp",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2p",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido8a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido8.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1��⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido8.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido8.inbound.Body}}",
        "offset": {
          "x": -1480,
          "y": 6810
        }
      }
    },
    {
      "name": "set_ref2p",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22p",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2p -%} {{flow.variables.set_ref2p | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2p"
          }
        ],
        "offset": {
          "x": -1170,
          "y": 6820
        }
      }
    },
    {
      "name": "split_ref_22p",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo8",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2p}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2p}}",
        "offset": {
          "x": -850,
          "y": 6820
        }
      }
    },
    {
      "name": "error_codigo8",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22p",
          "event": "sent"
        },
        {
          "next": "function_22p",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -520,
          "y": 6820
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22p",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido8",
          "event": "success"
        },
        {
          "next": "codigo_referido8",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -200,
          "y": 6820
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido8a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2q",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2130,
          "y": 7000
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2q",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refq",
          "event": "success"
        },
        {
          "next": "split_refq",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1800,
          "y": 7000
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refq",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2q",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido8",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido8a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido8a.inbound.Body}}",
        "offset": {
          "x": -1470,
          "y": 7000
        }
      }
    },
    {
      "name": "set_ref2q",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22q",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2q -%} {{flow.variables.set_ref2q | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2q"
          }
        ],
        "offset": {
          "x": -1150,
          "y": 7010
        }
      }
    },
    {
      "name": "split_ref_22q",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo8a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2q}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2q}}",
        "offset": {
          "x": -830,
          "y": 7000
        }
      }
    },
    {
      "name": "error_codigo8a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22q",
          "event": "sent"
        },
        {
          "next": "function_22q",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -510,
          "y": 7000
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22q",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido8a",
          "event": "success"
        },
        {
          "next": "codigo_referido8a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -200,
          "y": 6990
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido8",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refr",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2120,
          "y": 7190
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido8a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refr",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refr",
          "event": "success"
        },
        {
          "next": "split_refr",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1800,
          "y": 7190
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refr",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refr",
          "event": "noMatch"
        },
        {
          "next": "sm_9",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido8.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido8a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido8.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido8.inbound.Body}}",
        "offset": {
          "x": -1470,
          "y": 7190
        }
      }
    },
    {
      "name": "set_refr",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_rr",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refr -%} {{flow.variables.set_refr| plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refr"
          }
        ],
        "offset": {
          "x": -1150,
          "y": 7200
        }
      }
    },
    {
      "name": "split_ref_rr",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_r",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refr}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refr}}",
        "offset": {
          "x": -810,
          "y": 7200
        }
      }
    },
    {
      "name": "error_codigo_r",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_rr",
          "event": "sent"
        },
        {
          "next": "function_rr",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -490,
          "y": 7200
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_rr",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido8",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido8",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -190,
          "y": 7200
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_9",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_9",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2130,
          "y": 7390
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_9",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido9",
          "event": "success"
        },
        {
          "next": "codigo_referido9",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1790,
          "y": 7400
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido9",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2s",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2130,
          "y": 7570
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Te gustaría registrar *otro código*? \n\nRecuerda que al registrar un *nuevo código* le brindas a la persona que te lo compartió la oportunidad de participar en una rifa. ¡Todos tienen la misma oportunidad de ganar, habrá un ganador cada 50 personas!\n\nEnvía:\n*1*: si quieres agregar otro código\n*2*: si no tienes más códigos para  agregar",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2s",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refs",
          "event": "success"
        },
        {
          "next": "split_refs",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1800,
          "y": 7570
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refs",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2s",
          "event": "noMatch"
        },
        {
          "next": "codigo_referido9a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.codigo_referido9.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.codigo_referido9.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido9.inbound.Body}}",
        "offset": {
          "x": -1480,
          "y": 7560
        }
      }
    },
    {
      "name": "set_ref2s",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22s",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2s -%} {{flow.variables.set_ref2s | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2s"
          }
        ],
        "offset": {
          "x": -1170,
          "y": 7560
        }
      }
    },
    {
      "name": "split_ref_22s",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo9",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">5",
              "arguments": [
                "{{flow.variables.set_ref2s}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2s}}",
        "offset": {
          "x": -850,
          "y": 7560
        }
      }
    },
    {
      "name": "error_codigo9",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22s",
          "event": "sent"
        },
        {
          "next": "function_22s",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -520,
          "y": 7560
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22s",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido9",
          "event": "success"
        },
        {
          "next": "codigo_referido9",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -200,
          "y": 7560
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "codigo_referido9a",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref2t",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2110,
          "y": 7790
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Escribe a continuación el código que te compartieron.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref2t",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_reft",
          "event": "success"
        },
        {
          "next": "split_reft",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1780,
          "y": 7790
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_reft",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref2t",
          "event": "noMatch"
        },
        {
          "next": "conf_codigo_referido9",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid code",
              "arguments": [
                "{{widgets.codigo_referido9a.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^\\d\\d\\d\\d[rR]\\d\\d$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.codigo_referido9a.inbound.Body}}",
        "offset": {
          "x": -1450,
          "y": 7790
        }
      }
    },
    {
      "name": "set_ref2t",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_22t",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref2t -%} {{flow.variables.set_ref2t | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref2q"
          }
        ],
        "offset": {
          "x": -1130,
          "y": 7800
        }
      }
    },
    {
      "name": "split_ref_22t",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo9a",
          "event": "noMatch"
        },
        {
          "next": "invalid_code",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref2t}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref2t}}",
        "offset": {
          "x": -810,
          "y": 7790
        }
      }
    },
    {
      "name": "error_codigo9a",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_22t",
          "event": "sent"
        },
        {
          "next": "function_22t",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -490,
          "y": 7790
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el código que te compartieron."
      }
    },
    {
      "name": "function_22t",
      "type": "run-function",
      "transitions": [
        {
          "next": "codigo_referido9a",
          "event": "success"
        },
        {
          "next": "codigo_referido9a",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -180,
          "y": 7780
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "conf_codigo_referido9",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_refu",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2110,
          "y": 8000
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Confirmas que  {{widgets.codigo_referido8a.inbound.Body}}  es el  código que quieres registrar?\n\nEnvía:\n*1*: Sí\n*2*: No",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_refu",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_refu",
          "event": "success"
        },
        {
          "next": "split_refu",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1790,
          "y": 8000
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_refu",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_refu",
          "event": "noMatch"
        },
        {
          "next": "sm_10",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "1",
              "arguments": [
                "{{widgets.conf_codigo_referido9.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1, 1 ,1  ,*1*,1️⃣"
            }
          ]
        },
        {
          "next": "codigo_referido9a",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "2",
              "arguments": [
                "{{widgets.conf_codigo_referido9.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2, 2 ,2  ,*2*,dos,2️⃣"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.conf_codigo_referido9.inbound.Body}}",
        "offset": {
          "x": -1460,
          "y": 8000
        }
      }
    },
    {
      "name": "set_refu",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_uu",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_refu -%} {{flow.variables.set_refu| plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_refu"
          }
        ],
        "offset": {
          "x": -1140,
          "y": 8010
        }
      }
    },
    {
      "name": "split_ref_uu",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_codigo_u",
          "event": "noMatch"
        },
        {
          "next": "ref_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "5",
              "arguments": [
                "{{flow.variables.set_refu}}"
              ],
              "type": "greater_than",
              "value": "5"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_refu}}",
        "offset": {
          "x": -800,
          "y": 8010
        }
      }
    },
    {
      "name": "error_codigo_u",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_uu",
          "event": "sent"
        },
        {
          "next": "function_uu",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -490,
          "y": 8020
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas."
      }
    },
    {
      "name": "function_uu",
      "type": "run-function",
      "transitions": [
        {
          "next": "conf_codigo_referido9",
          "event": "success"
        },
        {
          "next": "conf_codigo_referido9",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -180,
          "y": 8010
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm_10",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm_10",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2120,
          "y": 8210
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Gracias por tu respuesta, validaremos este código para registrarte en el estudio."
      }
    },
    {
      "name": "wait_sm_10",
      "type": "run-function",
      "transitions": [
        {
          "next": "sm",
          "event": "success"
        },
        {
          "next": "sm",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1780,
          "y": 8220
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "sm",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_sm",
          "event": "sent"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -2140,
          "y": 8440
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "A continuación, tomaremos algunos datos personales para completar el registro y poder contactarte en futuras ocasiones. Recuerda que toda la información suministrada por este medio es estrictamente confidencial y será protegida. Si estás de acuerdo con brindar este tipo de información, contesta las siguientes preguntas."
      }
    },
    {
      "name": "wait_sm",
      "type": "run-function",
      "transitions": [
        {
          "next": "ref_name",
          "event": "success"
        },
        {
          "next": "ref_name",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1780,
          "y": 8440
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "wait_invalid_code",
      "type": "run-function",
      "transitions": [
        {
          "next": "ref_name",
          "event": "success"
        },
        {
          "next": "ref_name",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -1890,
          "y": 860
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "phone2",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref8",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2870,
          "y": 12430
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Deseas registrar algún otro número de celular al que te podamos contactar? \n\nEnvía:\n*1* si tu respuesta es: *Sí*\n*2* si tu respuesta es: *No*",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref8",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref8",
          "event": "success"
        },
        {
          "next": "split_ref8",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2540,
          "y": 12430
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref8",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref8",
          "event": "noMatch"
        },
        {
          "next": "phone2_number",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Sí",
              "arguments": [
                "{{widgets.phone2.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, 1,1 ,si,sí,SÍ,SI"
            }
          ]
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Omitir",
              "arguments": [
                "{{widgets.phone2.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "omitir,Omitir,OMITIR"
            }
          ]
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "No",
              "arguments": [
                "{{widgets.phone2.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2,2 , 2,no,NO"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.phone2.inbound.Body}}",
        "offset": {
          "x": -2230,
          "y": 12440
        }
      }
    },
    {
      "name": "set_ref8",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_8",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref8 -%} {{flow.variables.set_ref8 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref8"
          }
        ],
        "offset": {
          "x": -1890,
          "y": 12460
        }
      }
    },
    {
      "name": "split_ref_8",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_phone2",
          "event": "noMatch"
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref8}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref8}}",
        "offset": {
          "x": -1560,
          "y": 12440
        }
      }
    },
    {
      "name": "error_phone2",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_8",
          "event": "sent"
        },
        {
          "next": "function_8",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1240,
          "y": 12460
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No logro entender tu respuesta, recuerda enviar únicamente el *número* que se relaciona a tu respuesta.\n\nSoy un robot y no puedo entender otro tipo de respuestas."
      }
    },
    {
      "name": "function_8",
      "type": "run-function",
      "transitions": [
        {
          "next": "phone2",
          "event": "success"
        },
        {
          "next": "phone2",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -910,
          "y": 12440
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "phone2_number",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref9",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2870,
          "y": 12670
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Cuál es el número que deseas registrar?",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref9",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref9",
          "event": "success"
        },
        {
          "next": "split_ref9",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2530,
          "y": 12680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref9",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref9",
          "event": "noMatch"
        },
        {
          "next": "phone2_owner",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid phone",
              "arguments": [
                "{{widgets.phone2_number.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[3-4][0-9]{9}$"
            }
          ]
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Omitir",
              "arguments": [
                "{{widgets.phone2_number.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "omitir,Omitir,OMITIR"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.phone2_number.inbound.Body}}",
        "offset": {
          "x": -2200,
          "y": 12680
        }
      }
    },
    {
      "name": "set_ref9",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_9",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref9 -%} {{flow.variables.set_ref9 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref9"
          }
        ],
        "offset": {
          "x": -1840,
          "y": 12680
        }
      }
    },
    {
      "name": "split_ref_9",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_phone2_number",
          "event": "noMatch"
        },
        {
          "next": "phone2_owner",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref9}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref9}}",
        "offset": {
          "x": -1500,
          "y": 12680
        }
      }
    },
    {
      "name": "error_phone2_number",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_9",
          "event": "sent"
        },
        {
          "next": "function_9",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1180,
          "y": 12680
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No logro entender tu respuesta, recuerda enviar únicamente tu  número de telefono *sin espacios y sin incluir el indicativo de país.*\n\nSoy un robot y no puedo entender otro tipo de respuestas."
      }
    },
    {
      "name": "function_9",
      "type": "run-function",
      "transitions": [
        {
          "next": "phone2_number",
          "event": "success"
        },
        {
          "next": "phone2_number",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -860,
          "y": 12680
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "phone2_owner",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref10",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2860,
          "y": 12910
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿El número es tuyo o de alguna otra persona?  \n\nEnvía:\n*1* si tu respuesta es: *Yo soy la persona propietaria*\n*2* si tu respuesta es: *Yo no soy la persona propietaria*",
        "timeout": "3600"
      }
    },
    {
      "name": "phone2_name",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_ref11",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -2880,
          "y": 13140
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "¿Nos podrías indicar por favor el nombre de esa persona? \n\nResponde únicamente el nombre con *letras*, NO incluyas caracteres especiales, tildes ni ñ.",
        "timeout": "3600"
      }
    },
    {
      "name": "wait_ref11",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref11",
          "event": "success"
        },
        {
          "next": "split_ref11",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2540,
          "y": 13130
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "wait_ref10",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_ref10",
          "event": "success"
        },
        {
          "next": "split_ref10",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -2540,
          "y": 12910
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "split_ref11",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref11",
          "event": "noMatch"
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid name",
              "arguments": [
                "{{widgets.phone2_name.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[a-zA-Z_ ]*$"
            }
          ]
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Omitir",
              "arguments": [
                "{{widgets.phone2_name.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "omitir,Omitir,OMITIR"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.phone2_name.inbound.Body}}",
        "offset": {
          "x": -2210,
          "y": 13120
        }
      }
    },
    {
      "name": "split_ref10",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_ref10",
          "event": "noMatch"
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "SI",
              "arguments": [
                "{{widgets.phone2_owner.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "SI,si, si,si , SI,SI ,SI.,si.,1,1 , 1,1."
            }
          ]
        },
        {
          "next": "phone2_name",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "NO",
              "arguments": [
                "{{widgets.phone2_owner.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, 2,2 ,2."
            }
          ]
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Omitir",
              "arguments": [
                "{{widgets.phone2_owner.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "omitir,Omitir,OMITIR"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.phone2_owner.inbound.Body}}",
        "offset": {
          "x": -2200,
          "y": 12890
        }
      }
    },
    {
      "name": "set_ref11",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_11",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref11 -%} {{flow.variables.set_ref11 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref11"
          }
        ],
        "offset": {
          "x": -1870,
          "y": 13120
        }
      }
    },
    {
      "name": "set_ref10",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_ref_10",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_ref10 -%} {{flow.variables.set_ref10 | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_ref10"
          }
        ],
        "offset": {
          "x": -1870,
          "y": 12900
        }
      }
    },
    {
      "name": "split_ref_11",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_phone2_name",
          "event": "noMatch"
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref11}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref11}}",
        "offset": {
          "x": -1560,
          "y": 13120
        }
      }
    },
    {
      "name": "split_ref_10",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "error_phone2_owner",
          "event": "noMatch"
        },
        {
          "next": "closure_referidos",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_ref10}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_ref10}}",
        "offset": {
          "x": -1560,
          "y": 12890
        }
      }
    },
    {
      "name": "error_phone2_name",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_11",
          "event": "sent"
        },
        {
          "next": "function_11",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1230,
          "y": 13110
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a las opciones ofrecidas. \n\nPor favor responde únicamente con el nombre sin caracteres especiales. *NO incluyas tildes ni ñ*."
      }
    },
    {
      "name": "error_phone2_owner",
      "type": "send-message",
      "transitions": [
        {
          "next": "function_10",
          "event": "sent"
        },
        {
          "next": "function_10",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1210,
          "y": 12880
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No logro entender tu respuesta, recuerda enviar únicamente el *número* que se relaciona a tu respuesta.\n\nSoy un robot y no puedo entender otro tipo de respuestas."
      }
    },
    {
      "name": "function_11",
      "type": "run-function",
      "transitions": [
        {
          "next": "phone2_name",
          "event": "success"
        },
        {
          "next": "phone2_name",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -900,
          "y": 13110
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "function_10",
      "type": "run-function",
      "transitions": [
        {
          "next": "phone2_owner",
          "event": "success"
        },
        {
          "next": "phone2_owner",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -880,
          "y": 12870
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "wait_celular_participante_2",
      "type": "run-function",
      "transitions": [
        {
          "next": "closure_participants",
          "event": "success"
        },
        {
          "next": "closure_participants",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -5500,
          "y": 3080
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "send_message_celp_2",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_celular_participante_2",
          "event": "sent"
        },
        {
          "next": "wait_celular_participante_2",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -5160,
          "y": 3080
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que no entiendo la respuesta.\n\nRecuerda que esta encuesta es automática y no entenderé ninguna respuesta diferente a números que empiecen por 3 o 4 de 10 dígitos."
      }
    },
    {
      "name": "split_celular_participante_2",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "send_message_celp_2",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": ">2",
              "arguments": [
                "{{flow.variables.set_celular_participante}}"
              ],
              "type": "greater_than",
              "value": "2"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{flow.variables.set_celular_participante}}",
        "offset": {
          "x": -4830,
          "y": 3080
        }
      }
    },
    {
      "name": "set_celular_participante",
      "type": "set-variables",
      "transitions": [
        {
          "next": "split_celular_participante_2",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "type": "string",
            "value": "{%- if flow.variables.set_celular_participante -%} {{flow.variables.set_celular_participante | plus: 1}} {%- else -%} 1 {%- endif -%}",
            "key": "set_celular_participante"
          }
        ],
        "offset": {
          "x": -4500,
          "y": 3090
        }
      }
    },
    {
      "name": "split_celular_participante",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "set_celular_participante",
          "event": "noMatch"
        },
        {
          "next": "closure_participants",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "Valid phone",
              "arguments": [
                "{{widgets.celular_participante.inbound.Body}}"
              ],
              "type": "regex",
              "value": "^[3][0-9]{9}$"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.celular_participante.inbound.Body}}",
        "offset": {
          "x": -4170,
          "y": 3070
        }
      }
    },
    {
      "name": "wait_celular_participante",
      "type": "run-function",
      "transitions": [
        {
          "next": "split_celular_participante",
          "event": "success"
        },
        {
          "next": "split_celular_participante",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -3820,
          "y": 3070
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    },
    {
      "name": "celular_participante",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "wait_celular_participante",
          "event": "incomingMessage"
        },
        {
          "next": "set_noreply1_ref",
          "event": "timeout"
        },
        {
          "next": "set_survey_failed_ref",
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -3470,
          "y": 3060
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Para finalizar, por favor escribe el número de celular con el que te registraste en nuestro estudio, así podremos ubicarte en nuestras bases de datos.",
        "timeout": "3600"
      }
    },
    {
      "name": "invalid_code_1",
      "type": "send-message",
      "transitions": [
        {
          "next": "wait_invalid_code_1",
          "event": "sent"
        },
        {
          "next": "wait_invalid_code_1",
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -660,
          "y": 860
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Me temo que el código que has tratado de ingresar no es válido. Por favor verifícalo con la persona que te lo compartió y vuelve a escribirnos."
      }
    },
    {
      "name": "wait_invalid_code_1",
      "type": "run-function",
      "transitions": [
        {
          "next": "closure_referidos",
          "event": "success"
        },
        {
          "next": "closure_referidos",
          "event": "fail"
        }
      ],
      "properties": {
        "service_sid": "ZS98a61cbdd0f43c6a1151754946c0de78",
        "environment_sid": "ZEba4e92cdd7575a97a3846322a188d18b",
        "offset": {
          "x": -330,
          "y": 860
        },
        "function_sid": "ZH79d4f072caf67c0d6d76ccd86cb5f668",
        "url": "https://aletorio-1295.twil.io/wait"
      }
    }
  ],
  "initial_state": "Trigger",
  "flags": {
    "allow_concurrent_calls": true
  }
}